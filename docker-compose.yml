version: '3.8'

services:
  local-agent:
    build: 
      context: .
      ssh: 
        - default
    ports:
      - "4000:4000"
    volumes:
      - .:/app
      - deps:/app/deps
      - build:/app/_build
      - ${SSH_AUTH_SOCK}:/ssh-agent
    environment:
      - MIX_ENV=dev
      - PHOENIX_LIVE_RELOAD=true
      - SSH_AUTH_SOCK=/ssh-agent
    env_file:
      - .env
    command: bash -c "mix do deps.get, deps.compile && mix phx.server"
    # Enable inotify events
    privileged: true

volumes:
  deps:
  build: 